# https://medium.com/@a.hr.mostafavi/using-lf-file-manager-on-windows-fc4f1e4e1442
# https://github.com/ahrm/dotfiles/blob/main/lf-windows/lfrc

# https://pkg.go.dev/github.com/gokcehan/lf
# https://github.dev/gokcehan/lf
# https://github.com/gokcehan/lf

# lf (list files)

# custom file preview
# set previewer "M:/Script/Pwsh/Cmdlet/lf/config/scripts/preview.bat"
# set period 1
# interpreter for shell commands, on windows by default it is cmd
# if use pwsh, it is slow, and has redraw problem
# set shell pwsh -nologo -noninteractive -noprofile
# reload config file using f5
map <f-5> push :source<space>M:/Script/Pwsh/Cmdlet/lf/config/lfrc<enter>

set icons
# set drawbox
# set filesep ";" #default is '/n'
# leave some space at the top and the bottom of the screen
set scrolloff 10
set info size:time
# jump to the first match after each keystroke during searching.
set incsearch
# enable *?[][^] in search/back-search /?, n: next;N:previous
# not work, test future version
# set globsearch
# show hidden files
set hidden

# comment out because it easily triggered by the cancel : input
# map <esc> quit # the same as q
# cmd on-quit &{{cd %fx%;echo 'dddd'}}
# during search to open
cmap <right> :cmd-enter; open

### file management
# rename
# todo: need to auto redraw
cmd rename %sh -c 'mv -i %f% $0'
# cmd rename %mv -i $f $1
map r
# faster
map rr push :rename<space>
# map r push :rename<space> %f% # %f% in the command line not expanded, so have to use a script
# https://github.com/gokcehan/lf/issues/329
cmd rename-with-name &pwsh -nologo -noninteractive -noprofile -file M:/Script/Pwsh/Cmdlet/lf/config/scripts/rename.ps1
# a little slower
map rn rename-with-name

# create files and directories
# note $env:0 not work
# cmd createfile ${{
#   $file = Read-host 'New File Name'
#   new-item -path $file
# }}
# # cmd createfile !new-item
# cmd createdir ${{
#   $dir = Read-host 'New Directory Name'
#   new-item $dir -Type Directory; #redraw
# }}
# map a push :createfile<enter>;redraw
# map A push :createdir<enter>
cmd createfile %sh -c 'touch $0'
cmd createdir %sh -c 'mkdir $0'
map af push :createfile<space>
map ad push :createdir<space>
# selection
# map u
# unselect all
map su unselect
# map i
map si invert
map sgg push :glob-select<space>
map sgu push :glob-unselect<space>
# <space> toggle

## copy
# unmap y, it's yark by default
map y
map yy copy %fx%
# map Y %$env:fx | scb
# copy file path; note: c is mapped to clear by default
map yp %echo %fx% | clip
# copy work directory
cmd copy-current-directory %echo %PWD%| clip
map yd copy-current-directory
# copy current file names
cmd copy-file-name &pwsh -nologo -noninteractive -noprofile -file M:/Script/Pwsh/Cmdlet/lf/config/scripts/copy-fileName.ps1
map yn copy-file-name

# delete
# note: $f is current selected file, $fs is selected files, $fx is $fs if select many else it is $f
# todo:trash not work
# cmd trash &Remove-ItemSafely env:fx env:1
map D delete
cmd trash $pwsh -nologo -noninteractive -noprofile -file M:/Script/Pwsh/Cmdlet/lf/config/scripts/trash.ps1
#;reload
map <delete> trash

# map T push &wt<enter>

## open
# define a custom 'open' command
# This command is called when current file is not a directory.
# change the default open command to work in powerShell
# cmd open &start $Env:f

# change the editor used in default editor keybinding
# There is no builtin terminal editor installed in Windows. The default editor
# mapping uses 'notepad' which launches in a separate GUI window. You may
# instead install a terminal editor of your choice and replace the default
# editor keybinding accordingly.

# note: the right arrow triggers default open
# open file in code
cmd vsCode &code %f%
map oc vsCode
# open explorer in current directory
# cmd file-Explorer push &start.<enter>
cmd file-Explorer &explorer /n, /select, %fx%
map oe file-Explorer
#default is e
cmd Notepad &Notepad %f%
map on Notepad
cmd open-With... &pwsh -nologo -noninteractive -noprofile -file M:/Script/Pwsh/Cmdlet/lf/config/scripts/openWith.ps1
map ow open-With...
# vim is there when we installed git
cmd Vim $vim %f%
map ov Vim
map op !pwsh -nologo -noprofile -file M:/Script/Pwsh/Cmdlet/lf/config/scripts/properity.ps1

# less is there when we installed git
# map i $less $Env:f

# archive management
cmd zip-to %sh -c 'c:/app/7-zip/7z a $0 %fx%'
cmd extract-to %sh -c 'c:/app/7-zip/7z  x %f% -o$0'
cmd extract-here %c:/app/7-zip/7z x %f%
cmd extract_auto %sh -c 'c:/app/7-zip/7z x %f% -o%f%'
cmd extract_and_remove %sh -c 'c:/app/7-zip/7z x %f% -o%f%_ && rm %f%'

cmd zip-to-file push :zip-to<space>
map zz zip-to-file
# map zut push :extract-to<space>
cmd extract-to-folder push :extract-to<space>
map zut extract-to-folder
cmd extract-to-here push :extract-here<enter>
map zuh extract-to-here
map zur push :extract_and_remove<enter>

# map H high
# map M middle
# map L low
# quick preview
# v: default is invert select
# press v again to hide the preview window
map v &C:\app\QuickLook\QuickLook.exe %f%


# # must have at least a file in it
# cmd bookmark %sh -c 'python D:/lf_scripts/bookmark.py %f% $0'
# cmd goto_bookmark push $python<space>D:/lf_scripts/goto_bookmark.py<space>%id%<enter>
# map B push :bookmark<space>
# map b push :goto_bookmark<enter>

# # map F push :filter<enter>
# # map gF push :setfilter<enter>

# # # drag and drop
# cmd drag push &python<space>%%/drag.py<space>multi<space>%fx%<enter>
cmd dragonce push &python<space>M:/Script/Pwsh/Cmdlet/lf/config/scripts/drag.py<space>once<space>%fx%<enter>
map <c-d> push :dragonce<enter>

# # use c-f to fuzzy search
# cmd file-search push $python<space>D:/lf_scripts/fzfpy.py<space>%id%<enter>
# map <c-f> :file-search

# # cmd send_to_mobile %sh -c 'scp -P 2222 hex@192.168.1.151: %fx%'
# cmd send_to_mobile push $scp<space>-P<space>2222<space>%fx%<space>hex@192.168.1.151:<enter>
# cmd send_to_tablet push $scp<space>-P<space>2222<space>%fx%<space>hex@192.168.1.150:<enter>
# map st push :send_to_tablet<enter>
# map sm push :send_to_mobile<enter>

# Shell commands with multiline definitions and/or positional arguments and/or
# quotes do not work in Windows. For anything but the simplest shell commands,
# it is recommended to create separate script files and simply call them here
# in commands or mappings.
#
# Also, the default keybindings are defined using cmd syntax (i.e. '%EDITOR%')
# which does not work with powershell. Therefore, you need to override these
# keybindings with explicit choices accordingly.


# change the pager used in default pager keybinding
# The standard pager used in Windows is 'more' which is not a very capable
# pager. You may instead install a pager of your choice and replace the default
# pager keybinding accordingly.

# change the shell used in default shell keybinding
# map w $pwsh

# change 'doc' command to use a different pager
cmd doc $c:\app\lf\lf.exe -doc | less

# use enter for shell commands
# map <enter> shell

## execute current file (must be executable)
# # execute with shell
# map x $$f
# # execute with shell_wait
# map X !$f


## command line commands
# c-p
cmap <up> cmd-history-prev
# c-n
cmap <down> cmd-history-next
